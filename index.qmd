---
title: "Investment Strategy Analysis"
subtitle: "Monte Carlo Simulation of Multiplicative Investment Games"
format:
  html: 
    theme: cosmo
    toc: true
    toc-depth: 3
    number-sections: true
    code-fold: false
    embed-resources: true
  pdf: default
execute:
  echo: false
  eval: true
---

# Investment Strategy Analysis: Monte Carlo Simulation

::: {.callout-abstract}
## Executive Summary

This analysis examines two investment strategies using Monte Carlo simulation to understand the long-term behavior of multiplicative investment games. We investigate how expected value calculations can be misleading when applied to real-world investment scenarios with compounding effects.

**Key Finding**: Despite a positive 5% expected return, most simulations result in significant losses, demonstrating the critical importance of understanding risk distributions rather than relying solely on expected values.
:::

## The Investment Game

::: {.panel-tabset}

### Strategy 1: Full Investment

Consider an investment game where you start with $1,000. Each year, a coin is flipped:
- **Heads (50% probability)**: Your entire balance increases by 50%
- **Tails (50% probability)**: Your entire balance decreases by 40%

This process continues annually from age 25 to 55 (30 years).

**Risk Profile**: High volatility with potential for massive gains or significant losses.

### Strategy 2: Partial Investment

In this modified approach, you must invest exactly 50% of your current balance each year:
- **Heads (50% probability)**: Your invested amount increases by 50%
- **Tails (50% probability)**: Your invested amount decreases by 40%
- The remaining 50% of your balance remains untouched

**Risk Profile**: Lower volatility with capital preservation focus.

:::

## Analysis Framework

### Expected Value Analysis

Let's first examine the theoretical expected value after one coin flip for Strategy 1:

```{r}
#| fig-cap: Expected value calculation for one coin flip

# Set seed for reproducibility
set.seed(123)

# Initial balance
initial_balance <- 1000

# After one coin flip:
# Heads (50% probability): Balance = 1000 * 1.5 = 1500
# Tails (50% probability): Balance = 1000 * 0.6 = 600

# Expected value calculation
prob_heads <- 0.5
prob_tails <- 0.5
balance_heads <- initial_balance * 1.5
balance_tails <- initial_balance * 0.6

expected_value <- prob_heads * balance_heads + prob_tails * balance_tails

cat("Expected Value Analysis:\n")
cat("Initial balance: $", initial_balance, "\n")
cat("Balance after heads (50% gain): $", balance_heads, "\n")
cat("Balance after tails (40% loss): $", balance_tails, "\n")
cat("Expected value: $", expected_value, "\n")
cat("Expected return: ", (expected_value - initial_balance) / initial_balance * 100, "%\n")
```

::: {.callout-important}
## Key Insight: Expected Value vs. Reality

The expected value after one coin flip is **$1,050**, representing a **5% expected return**. This suggests positive expected outcomes. However, as we'll see, this theoretical calculation can be misleading when applied to long-term multiplicative processes.

**Counter-Intuitive Finding**: Despite positive expected value, most simulations result in losses due to the multiplicative nature of compounding.
:::

## Single Simulation Analysis

Let's examine what happens in a single 30-year simulation:

```{r}
#| fig-cap: Single 30-year simulation of Strategy 1

suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(ggplot2))

# Set seed for reproducibility
set.seed(456)

# Parameters for investment game
initial_balance <- 1000
start_age <- 25
end_age <- 55
n_years <- end_age - start_age

# Function to simulate investment game
simulate_investment_game <- function(initial, years) {
  balance <- initial
  path <- numeric(years + 1)
  path[1] <- initial
  
  for (i in 1:years) {
    coin_flip <- rbinom(1, 1, 0.5)
    if (coin_flip == 1) {
      balance <- balance * 1.5  # 50% gain
    } else {
      balance <- balance * 0.6  # 40% loss
    }
    path[i + 1] <- balance
  }
  
  return(path)
}

# Run single simulation
investment_path <- simulate_investment_game(initial_balance, n_years)

# Create data frame
investment_data <- tibble(
  age = start_age:end_age,
  balance = investment_path
)

# Create time series plot
ggplot(investment_data, aes(x = age, y = balance)) +
  geom_line(color = "darkgreen", linewidth = 1.2) +
  geom_point(color = "darkred", size = 2) +
  geom_hline(yintercept = initial_balance, color = "blue", linetype = "dashed", linewidth = 1) +
  labs(
    title = "Investment Strategy 1: Single Simulation Path",
    subtitle = "Age 25 to 55 (30 years of investing)",
    x = "Age",
    y = "Account Balance ($)",
    caption = "Heads: +50%, Tails: -40% | Blue line shows initial balance"
  ) +
  scale_y_continuous(labels = scales::dollar_format()) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 14, face = "bold"),
    plot.subtitle = element_text(size = 12, color = "gray50")
  )

# Show final results
final_balance <- investment_data$balance[nrow(investment_data)]
total_return <- (final_balance - initial_balance) / initial_balance * 100

cat("\nSingle Simulation Results:\n")
cat("Initial balance (age 25): $", initial_balance, "\n")
cat("Final balance (age 55): $", round(final_balance, 2), "\n")
cat("Total return: ", round(total_return, 2), "%\n")
cat("Annualized return: ", round((final_balance/initial_balance)^(1/n_years) - 1, 4) * 100, "%\n")
```

## Monte Carlo Analysis: 100 Simulations

To understand the true risk profile, we run 100 simulations:

```{r}
#| fig-cap: Distribution of final balances from 100 simulations

suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(ggplot2))

# Set seed for reproducibility
set.seed(789)

# Parameters for investment game
initial_balance <- 1000
start_age <- 25
end_age <- 55
n_years <- end_age - start_age
n_sims <- 100

# Function to simulate final balance
simulate_final_balance <- function(initial, years) {
  balance <- initial
  for (i in 1:years) {
    coin_flip <- rbinom(1, 1, 0.5)
    if (coin_flip == 1) {
      balance <- balance * 1.5  # 50% gain
    } else {
      balance <- balance * 0.6  # 40% loss
    }
  }
  return(balance)
}

# Run 100 simulations
final_balances <- replicate(n_sims, simulate_final_balance(initial_balance, n_years))

# Create data frame
simulation_results <- tibble(
  sim_num = 1:n_sims,
  final_balance = final_balances
)

# Create histogram
ggplot(simulation_results, aes(x = final_balance)) +
  geom_histogram(bins = 20, fill = "steelblue", alpha = 0.8, color = "black") +
  geom_vline(xintercept = initial_balance, color = "red", linetype = "dashed", linewidth = 1) +
  geom_vline(xintercept = mean(final_balances), color = "green", linetype = "solid", linewidth = 1) +
  labs(
    title = "Distribution of Final Account Balances at Age 55",
    subtitle = "Strategy 1: 100 Simulations (30 years)",
    x = "Final Balance at Age 55 ($)",
    y = "Frequency",
    caption = "Red line: Initial balance ($1,000) | Green line: Mean final balance"
  ) +
  scale_x_continuous(labels = scales::dollar_format(), trans = "log10") +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 14, face = "bold"),
    plot.subtitle = element_text(size = 12, color = "gray50")
  )

# Summary statistics
summary_stats <- simulation_results %>%
  summarise(
    mean_balance = mean(final_balance),
    median_balance = median(final_balance),
    min_balance = min(final_balance),
    max_balance = max(final_balance),
    prob_above_initial = mean(final_balance > initial_balance),
    prob_above_10000 = mean(final_balance > 10000)
  )

cat("\nStrategy 1 Summary Statistics:\n")
print(summary_stats)
```

## Probability Analysis

```{r}
#| fig-cap: Probability analysis for various balance thresholds

# Calculate probability that final balance > $1,000
prob_above_1000 <- mean(final_balances > 1000)

# Calculate additional probability thresholds
prob_above_5000 <- mean(final_balances > 5000)
prob_above_10000 <- mean(final_balances > 10000)
prob_above_50000 <- mean(final_balances > 50000)

# Create probability summary
probability_summary <- tibble(
  threshold = c("$1,000", "$5,000", "$10,000", "$50,000"),
  probability = c(prob_above_1000, prob_above_5000, prob_above_10000, prob_above_50000),
  percentage = c(prob_above_1000, prob_above_5000, prob_above_10000, prob_above_50000) * 100
)

cat("Strategy 1 Probability Analysis:\n")
cat("============================\n")
cat("Probability that final balance > $1,000: ", round(prob_above_1000, 3), " (", round(prob_above_1000 * 100, 1), "%)\n")
cat("Probability that final balance > $5,000: ", round(prob_above_5000, 3), " (", round(prob_above_5000 * 100, 1), "%)\n")
cat("Probability that final balance > $10,000: ", round(prob_above_10000, 3), " (", round(prob_above_10000 * 100, 1), "%)\n")
cat("Probability that final balance > $50,000: ", round(prob_above_50000, 3), " (", round(prob_above_50000 * 100, 1), "%)\n")

# Show the probability summary table
print(probability_summary)
```

## Strategy 2 Analysis: 50% Investment Distribution

Let's examine the distribution of Strategy 2 results separately:

```{r}
#| fig-cap: Distribution of Strategy 2 final balances (50% investment rule)
#| echo: false

suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(ggplot2))

# Set seed for reproducibility
set.seed(999)

# Parameters for Strategy 2
initial_balance <- 1000
start_age <- 25
end_age <- 55
n_years <- end_age - start_age
n_sims <- 100

# Function to simulate Strategy 2 (50% betting rule)
simulate_strategy_2 <- function(initial, years) {
  balance <- initial
  for (i in 1:years) {
    # Bet exactly 50% of current balance
    bet_amount <- balance * 0.5
    remaining_balance <- balance - bet_amount
    
    coin_flip <- rbinom(1, 1, 0.5)
    if (coin_flip == 1) {
      # Win: bet amount increases by 50%
      bet_result <- bet_amount * 1.5
    } else {
      # Lose: bet amount decreases by 40%
      bet_result <- bet_amount * 0.6
    }
    
    # New balance = remaining balance + bet result
    balance <- remaining_balance + bet_result
  }
  return(balance)
}

# Run 100 simulations for Strategy 2
strategy_2_balances <- replicate(n_sims, simulate_strategy_2(initial_balance, n_years))

# Create data frame for Strategy 2
strategy_2_results <- tibble(
  sim_num = 1:n_sims,
  final_balance = strategy_2_balances
)

# Create Strategy 2 histogram
ggplot(strategy_2_results, aes(x = final_balance)) +
  geom_histogram(bins = 15, fill = "orange", alpha = 0.8, color = "black") +
  geom_vline(xintercept = initial_balance, color = "red", linetype = "dashed", linewidth = 1) +
  geom_vline(xintercept = mean(strategy_2_balances), color = "darkorange", linetype = "solid", linewidth = 1) +
  labs(
    title = "Distribution of Final Balances: Strategy 2 (50% Investment)",
    subtitle = "100 Simulations - Conservative Approach",
    x = "Final Balance at Age 55 ($)",
    y = "Frequency",
    caption = "Red line: Initial balance ($1,000) | Orange line: Mean final balance"
  ) +
  scale_x_continuous(labels = scales::dollar_format()) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 14, face = "bold"),
    plot.subtitle = element_text(size = 12, color = "gray50")
  )

# Summary statistics for Strategy 2
strategy_2_summary <- strategy_2_results %>%
  summarise(
    mean_balance = mean(final_balance),
    median_balance = median(final_balance),
    min_balance = min(final_balance),
    max_balance = max(final_balance),
    prob_above_initial = mean(final_balance > initial_balance),
    prob_above_10000 = mean(final_balance > 10000)
  )

cat("\nStrategy 2 Summary Statistics:\n")
print(strategy_2_summary)
```

## Strategy Comparison: Side-by-Side Analysis

Now let's analyze Strategy 2 (50% betting rule):

```{r}
#| fig-cap: Comparison of Strategy 1 vs Strategy 2

suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(ggplot2))

# Set seed for reproducibility
set.seed(999)

# Parameters for modified investment game
initial_balance <- 1000
start_age <- 25
end_age <- 55
n_years <- end_age - start_age
n_sims <- 100

# Function to simulate modified strategy (50% betting rule)
simulate_modified_strategy <- function(initial, years) {
  balance <- initial
  for (i in 1:years) {
    # Bet exactly 50% of current balance
    bet_amount <- balance * 0.5
    remaining_balance <- balance - bet_amount
    
    coin_flip <- rbinom(1, 1, 0.5)
    if (coin_flip == 1) {
      # Win: bet amount increases by 50%
      bet_result <- bet_amount * 1.5
    } else {
      # Lose: bet amount decreases by 40%
      bet_result <- bet_amount * 0.6
    }
    
    # New balance = remaining balance + bet result
    balance <- remaining_balance + bet_result
  }
  return(balance)
}

# Run 100 simulations for modified strategy
modified_final_balances <- replicate(n_sims, simulate_modified_strategy(initial_balance, n_years))

# Create comparison data frame
strategy_comparison <- tibble(
  sim_num = 1:n_sims,
  strategy_1 = final_balances,
  strategy_2 = modified_final_balances
)

# Calculate probabilities for modified strategy
prob_modified_above_1000 <- mean(modified_final_balances > 1000)
prob_modified_above_10000 <- mean(modified_final_balances > 10000)

# Calculate probabilities for original strategy (from previous analysis)
prob_original_above_1000 <- mean(final_balances > 1000)
prob_original_above_10000 <- mean(final_balances > 10000)

# Create comparison plot
comparison_data <- strategy_comparison %>%
  pivot_longer(cols = c(strategy_1, strategy_2), 
               names_to = "strategy", values_to = "final_balance") %>%
  mutate(strategy = case_when(
    strategy == "strategy_1" ~ "Strategy 1: Full Investment",
    strategy == "strategy_2" ~ "Strategy 2: 50% Investment"
  ))

ggplot(comparison_data, aes(x = final_balance, fill = strategy)) +
  geom_histogram(alpha = 0.7, bins = 20, position = "identity") +
  geom_vline(xintercept = 10000, color = "red", linetype = "dashed", linewidth = 1) +
  labs(
    title = "Strategy Comparison: Final Balance Distributions",
    subtitle = "100 Simulations Each (30 years)",
    x = "Final Balance at Age 55 ($)",
    y = "Frequency",
    fill = "Strategy",
    caption = "Red line shows $10,000 threshold"
  ) +
  scale_x_continuous(labels = scales::dollar_format(), trans = "log10") +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 14, face = "bold"),
    plot.subtitle = element_text(size = 12, color = "gray50"),
    legend.position = "bottom"
  )

# Summary statistics comparison
comparison_summary <- tibble(
  Strategy = c("Strategy 1: Full Investment", "Strategy 2: 50% Investment"),
  Mean_Balance = c(mean(final_balances), mean(modified_final_balances)),
  Median_Balance = c(median(final_balances), median(modified_final_balances)),
  Prob_Above_1000 = c(prob_original_above_1000, prob_modified_above_1000),
  Prob_Above_10000 = c(prob_original_above_10000, prob_modified_above_10000)
)

# Create a professional summary table
professional_summary <- comparison_summary %>%
  mutate(
    Strategy = case_when(
      Strategy == "Strategy 1: Full Investment" ~ "Strategy 1: Full Investment",
      Strategy == "Strategy 2: 50% Investment" ~ "Strategy 2: 50% Investment"
    ),
    Mean_Balance = paste0("$", format(round(Mean_Balance, 0), big.mark = ",")),
    Median_Balance = paste0("$", format(round(Median_Balance, 0), big.mark = ",")),
    Prob_Above_1000 = paste0(round(Prob_Above_1000 * 100, 0), "%"),
    Prob_Above_10000 = paste0(round(Prob_Above_10000 * 100, 0), "%")
  ) %>%
  rename(
    "Investment Strategy" = Strategy,
    "Average Final Balance" = Mean_Balance,
    "Median Final Balance" = Median_Balance,
    "Chance > $1,000" = Prob_Above_1000,
    "Chance > $10,000" = Prob_Above_10000
  )

# Display the professional table
knitr::kable(professional_summary, 
             caption = "Strategy Comparison: Final Results",
             align = c("l", "r", "r", "r", "r"),
             format = "html")

# Add key insights
cat("\n")
cat("## ðŸŽ¯ **Key Comparison Insights:**\n")
cat("â€¢ **Capital Preservation**: Strategy 2 is safer (39% vs 30% chance of keeping your $1,000)\n")
cat("â€¢ **Growth Potential**: Strategy 1 offers higher rewards (2% vs 0% chance of reaching $10,000)\n")
cat("â€¢ **Risk vs Reward**: Full investment is riskier but has potential for massive gains\n")
cat("â€¢ **Conservative Approach**: 50% investment strategy prioritizes capital preservation over growth\n")
```

## Risk-Return Analysis

Let's create a comprehensive risk-return visualization:

```{r}
#| fig-cap: Risk-Return scatter plot comparing both strategies
#| echo: false

suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(ggplot2))

# Combine all simulation data for risk-return analysis
combined_data <- tibble(
  strategy = rep(c("Strategy 1: Full Investment", "Strategy 2: 50% Investment"), each = 100),
  final_balance = c(final_balances, strategy_2_balances),
  log_return = log(c(final_balances, strategy_2_balances) / 1000)
) %>%
  group_by(strategy) %>%
  mutate(
    risk = sd(final_balance),
    return = mean(final_balance)
  )

# Create risk-return scatter plot
ggplot(combined_data, aes(x = risk, y = return, color = strategy)) +
  geom_point(size = 3, alpha = 0.7) +
  geom_text(aes(label = strategy), hjust = -0.1, vjust = 0.5, size = 3.5) +
  labs(
    title = "Risk-Return Analysis: Strategy Comparison",
    subtitle = "Higher risk strategies offer higher potential returns",
    x = "Risk (Standard Deviation of Final Balances)",
    y = "Average Return (Mean Final Balance)",
    caption = "Each point represents 100 simulations of each strategy"
  ) +
  scale_x_continuous(labels = scales::dollar_format()) +
  scale_y_continuous(labels = scales::dollar_format()) +
  scale_color_manual(values = c("Strategy 1: Full Investment" = "steelblue", 
                               "Strategy 2: 50% Investment" = "orange")) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 14, face = "bold"),
    plot.subtitle = element_text(size = 12, color = "gray50"),
    legend.position = "none"
  )

# Summary statistics for risk-return analysis
risk_return_summary <- combined_data %>%
  group_by(strategy) %>%
  summarise(
    mean_return = mean(final_balance),
    risk = sd(final_balance),
    min_return = min(final_balance),
    max_return = max(final_balance),
    coefficient_of_variation = risk / mean_return
  )

cat("\nRisk-Return Summary:\n")
print(risk_return_summary)
```

## Key Findings

::: {.callout-warning}
## Risk-Return Analysis

1. **Expected Value Misleading**: Despite a positive 5% expected return, most simulations result in losses below the initial investment.

2. **Extreme Volatility**: Final balances range from near zero to potentially millions, demonstrating the high-risk nature of multiplicative investment strategies.

3. **Strategy Comparison**: The 50% investment strategy (Strategy 2) shows different risk-return characteristics compared to full investment (Strategy 1).
:::

::: {.callout-note}
## Probability Results

- **Strategy 1 (Full Investment)**:
  - Probability of ending above $1,000: **30%**
  - Probability of ending above $10,000: **2%**

- **Strategy 2 (50% Investment)**:
  - Probability of ending above $1,000: **39%**
  - Probability of ending above $10,000: **0%**

**Key Insight**: Strategy 2 is safer for preserving capital but offers no chance of high returns.
:::

### Strategic Implications

This analysis demonstrates several critical concepts:

1. **Expected Value vs. Reality**: Positive expected value doesn't guarantee positive outcomes in multiplicative processes
2. **Compounding Effects**: Early losses have devastating long-term impacts due to the multiplicative nature
3. **Risk Management**: Position sizing and diversification are crucial for managing investment risk
4. **Simulation Power**: Monte Carlo methods reveal the true distribution of possible outcomes

::: {.callout-tip}
## Conclusion

This Monte Carlo analysis reveals the counter-intuitive nature of multiplicative investment processes. While theoretical expected value calculations suggest positive returns, the reality of compounding effects leads to extreme outcomes with high downside risk. Understanding these dynamics is essential for making informed investment decisions and implementing appropriate risk management strategies.

The comparison between full investment and partial investment strategies demonstrates how position sizing can significantly impact risk-return profiles, highlighting the importance of strategic portfolio management in real-world investment scenarios.

**Key Takeaway**: Expected value alone is insufficient for investment decisions - understanding the full distribution of outcomes is crucial for risk management.

### Strategic Recommendations

1. **For Conservative Investors**: Choose Strategy 2 for better capital preservation
2. **For Risk-Tolerant Investors**: Strategy 1 offers higher potential rewards
3. **For All Investors**: Always analyze the full distribution of outcomes, not just expected values
4. **Portfolio Management**: Consider position sizing and diversification strategies
:::