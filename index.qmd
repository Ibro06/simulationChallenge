---
title: "Investment Strategy Analysis"
subtitle: "Monte Carlo Simulation of Multiplicative Investment Games"
format:
  html: default
  pdf: default
execute:
  echo: false
  eval: true
---

# Investment Strategy Analysis: Monte Carlo Simulation

## Executive Summary

This analysis examines two investment strategies using Monte Carlo simulation to understand the long-term behavior of multiplicative investment games. We investigate how expected value calculations can be misleading when applied to real-world investment scenarios with compounding effects.

## The Investment Game

### Strategy 1: Full Investment Strategy

Consider an investment game where you start with $1,000. Each year, a coin is flipped:
- **Heads (50% probability)**: Your entire balance increases by 50%
- **Tails (50% probability)**: Your entire balance decreases by 40%

This process continues annually from age 25 to 55 (30 years).

### Strategy 2: Partial Investment Strategy

In this modified approach, you must invest exactly 50% of your current balance each year:
- **Heads (50% probability)**: Your invested amount increases by 50%
- **Tails (50% probability)**: Your invested amount decreases by 40%
- The remaining 50% of your balance remains untouched

## Analysis Framework

### Expected Value Analysis

Let's first examine the theoretical expected value after one coin flip for Strategy 1:

```{r}
#| fig-cap: Expected value calculation for one coin flip

# Set seed for reproducibility
set.seed(123)

# Initial balance
initial_balance <- 1000

# After one coin flip:
# Heads (50% probability): Balance = 1000 * 1.5 = 1500
# Tails (50% probability): Balance = 1000 * 0.6 = 600

# Expected value calculation
prob_heads <- 0.5
prob_tails <- 0.5
balance_heads <- initial_balance * 1.5
balance_tails <- initial_balance * 0.6

expected_value <- prob_heads * balance_heads + prob_tails * balance_tails

cat("Expected Value Analysis:\n")
cat("Initial balance: $", initial_balance, "\n")
cat("Balance after heads (50% gain): $", balance_heads, "\n")
cat("Balance after tails (40% loss): $", balance_tails, "\n")
cat("Expected value: $", expected_value, "\n")
cat("Expected return: ", (expected_value - initial_balance) / initial_balance * 100, "%\n")
```

::: {.callout-important}
## Key Insight: Expected Value vs. Reality

The expected value after one coin flip is **$1,050**, representing a **5% expected return**. This suggests positive expected outcomes. However, as we'll see, this theoretical calculation can be misleading when applied to long-term multiplicative processes.

**Counter-Intuitive Finding**: Despite positive expected value, most simulations result in losses due to the multiplicative nature of compounding.
:::

## Single Simulation Analysis

Let's examine what happens in a single 30-year simulation:

```{r}
#| fig-cap: Single 30-year simulation of Strategy 1

suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(ggplot2))

# Set seed for reproducibility
set.seed(456)

# Parameters for investment game
initial_balance <- 1000
start_age <- 25
end_age <- 55
n_years <- end_age - start_age

# Function to simulate investment game
simulate_investment_game <- function(initial, years) {
  balance <- initial
  path <- numeric(years + 1)
  path[1] <- initial
  
  for (i in 1:years) {
    coin_flip <- rbinom(1, 1, 0.5)
    if (coin_flip == 1) {
      balance <- balance * 1.5  # 50% gain
    } else {
      balance <- balance * 0.6  # 40% loss
    }
    path[i + 1] <- balance
  }
  
  return(path)
}

# Run single simulation
investment_path <- simulate_investment_game(initial_balance, n_years)

# Create data frame
investment_data <- tibble(
  age = start_age:end_age,
  balance = investment_path
)

# Create time series plot
ggplot(investment_data, aes(x = age, y = balance)) +
  geom_line(color = "darkgreen", linewidth = 1.2) +
  geom_point(color = "darkred", size = 2) +
  geom_hline(yintercept = initial_balance, color = "blue", linetype = "dashed", linewidth = 1) +
  labs(
    title = "Investment Strategy 1: Single Simulation Path",
    subtitle = "Age 25 to 55 (30 years of investing)",
    x = "Age",
    y = "Account Balance ($)",
    caption = "Heads: +50%, Tails: -40% | Blue line shows initial balance"
  ) +
  scale_y_continuous(labels = scales::dollar_format()) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 14, face = "bold"),
    plot.subtitle = element_text(size = 12, color = "gray50")
  )

# Show final results
final_balance <- investment_data$balance[nrow(investment_data)]
total_return <- (final_balance - initial_balance) / initial_balance * 100

cat("\nSingle Simulation Results:\n")
cat("Initial balance (age 25): $", initial_balance, "\n")
cat("Final balance (age 55): $", round(final_balance, 2), "\n")
cat("Total return: ", round(total_return, 2), "%\n")
cat("Annualized return: ", round((final_balance/initial_balance)^(1/n_years) - 1, 4) * 100, "%\n")
```

## Monte Carlo Analysis: 100 Simulations

To understand the true risk profile, we run 100 simulations:

```{r}
#| fig-cap: Distribution of final balances from 100 simulations

suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(ggplot2))

# Set seed for reproducibility
set.seed(789)

# Parameters for investment game
initial_balance <- 1000
start_age <- 25
end_age <- 55
n_years <- end_age - start_age
n_sims <- 100

# Function to simulate final balance
simulate_final_balance <- function(initial, years) {
  balance <- initial
  for (i in 1:years) {
    coin_flip <- rbinom(1, 1, 0.5)
    if (coin_flip == 1) {
      balance <- balance * 1.5  # 50% gain
    } else {
      balance <- balance * 0.6  # 40% loss
    }
  }
  return(balance)
}

# Run 100 simulations
final_balances <- replicate(n_sims, simulate_final_balance(initial_balance, n_years))

# Create data frame
simulation_results <- tibble(
  sim_num = 1:n_sims,
  final_balance = final_balances
)

# Create histogram
ggplot(simulation_results, aes(x = final_balance)) +
  geom_histogram(bins = 20, fill = "steelblue", alpha = 0.8, color = "black") +
  geom_vline(xintercept = initial_balance, color = "red", linetype = "dashed", linewidth = 1) +
  geom_vline(xintercept = mean(final_balances), color = "green", linetype = "solid", linewidth = 1) +
  labs(
    title = "Distribution of Final Account Balances at Age 55",
    subtitle = "Strategy 1: 100 Simulations (30 years)",
    x = "Final Balance at Age 55 ($)",
    y = "Frequency",
    caption = "Red line: Initial balance ($1,000) | Green line: Mean final balance"
  ) +
  scale_x_continuous(labels = scales::dollar_format(), trans = "log10") +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 14, face = "bold"),
    plot.subtitle = element_text(size = 12, color = "gray50")
  )

# Summary statistics
summary_stats <- simulation_results %>%
  summarise(
    mean_balance = mean(final_balance),
    median_balance = median(final_balance),
    min_balance = min(final_balance),
    max_balance = max(final_balance),
    prob_above_initial = mean(final_balance > initial_balance),
    prob_above_10000 = mean(final_balance > 10000)
  )

cat("\nStrategy 1 Summary Statistics:\n")
print(summary_stats)
```

## Probability Analysis

```{r}
#| fig-cap: Probability analysis for various balance thresholds

# Calculate probability that final balance > $1,000
prob_above_1000 <- mean(final_balances > 1000)

# Calculate additional probability thresholds
prob_above_5000 <- mean(final_balances > 5000)
prob_above_10000 <- mean(final_balances > 10000)
prob_above_50000 <- mean(final_balances > 50000)

# Create probability summary
probability_summary <- tibble(
  threshold = c("$1,000", "$5,000", "$10,000", "$50,000"),
  probability = c(prob_above_1000, prob_above_5000, prob_above_10000, prob_above_50000),
  percentage = c(prob_above_1000, prob_above_5000, prob_above_10000, prob_above_50000) * 100
)

cat("Strategy 1 Probability Analysis:\n")
cat("============================\n")
cat("Probability that final balance > $1,000: ", round(prob_above_1000, 3), " (", round(prob_above_1000 * 100, 1), "%)\n")
cat("Probability that final balance > $5,000: ", round(prob_above_5000, 3), " (", round(prob_above_5000 * 100, 1), "%)\n")
cat("Probability that final balance > $10,000: ", round(prob_above_10000, 3), " (", round(prob_above_10000 * 100, 1), "%)\n")
cat("Probability that final balance > $50,000: ", round(prob_above_50000, 3), " (", round(prob_above_50000 * 100, 1), "%)\n")

# Show the probability summary table
print(probability_summary)
```

## Strategy Comparison: Partial Investment Approach

Now let's analyze Strategy 2 (50% betting rule):

```{r}
#| fig-cap: Comparison of Strategy 1 vs Strategy 2

suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(ggplot2))

# Set seed for reproducibility
set.seed(999)

# Parameters for modified investment game
initial_balance <- 1000
start_age <- 25
end_age <- 55
n_years <- end_age - start_age
n_sims <- 100

# Function to simulate modified strategy (50% betting rule)
simulate_modified_strategy <- function(initial, years) {
  balance <- initial
  for (i in 1:years) {
    # Bet exactly 50% of current balance
    bet_amount <- balance * 0.5
    remaining_balance <- balance - bet_amount
    
    coin_flip <- rbinom(1, 1, 0.5)
    if (coin_flip == 1) {
      # Win: bet amount increases by 50%
      bet_result <- bet_amount * 1.5
    } else {
      # Lose: bet amount decreases by 40%
      bet_result <- bet_amount * 0.6
    }
    
    # New balance = remaining balance + bet result
    balance <- remaining_balance + bet_result
  }
  return(balance)
}

# Run 100 simulations for modified strategy
modified_final_balances <- replicate(n_sims, simulate_modified_strategy(initial_balance, n_years))

# Create comparison data frame
strategy_comparison <- tibble(
  sim_num = 1:n_sims,
  strategy_1 = final_balances,
  strategy_2 = modified_final_balances
)

# Calculate probabilities for modified strategy
prob_modified_above_1000 <- mean(modified_final_balances > 1000)
prob_modified_above_10000 <- mean(modified_final_balances > 10000)

# Calculate probabilities for original strategy (from previous analysis)
prob_original_above_1000 <- mean(final_balances > 1000)
prob_original_above_10000 <- mean(final_balances > 10000)

# Create comparison plot
comparison_data <- strategy_comparison %>%
  pivot_longer(cols = c(strategy_1, strategy_2), 
               names_to = "strategy", values_to = "final_balance") %>%
  mutate(strategy = case_when(
    strategy == "strategy_1" ~ "Strategy 1: Full Investment",
    strategy == "strategy_2" ~ "Strategy 2: 50% Investment"
  ))

ggplot(comparison_data, aes(x = final_balance, fill = strategy)) +
  geom_histogram(alpha = 0.7, bins = 20, position = "identity") +
  geom_vline(xintercept = 10000, color = "red", linetype = "dashed", linewidth = 1) +
  labs(
    title = "Strategy Comparison: Final Balance Distributions",
    subtitle = "100 Simulations Each (30 years)",
    x = "Final Balance at Age 55 ($)",
    y = "Frequency",
    fill = "Strategy",
    caption = "Red line shows $10,000 threshold"
  ) +
  scale_x_continuous(labels = scales::dollar_format(), trans = "log10") +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 14, face = "bold"),
    plot.subtitle = element_text(size = 12, color = "gray50"),
    legend.position = "bottom"
  )

# Summary statistics comparison
comparison_summary <- tibble(
  Strategy = c("Strategy 1: Full Investment", "Strategy 2: 50% Investment"),
  Mean_Balance = c(mean(final_balances), mean(modified_final_balances)),
  Median_Balance = c(median(final_balances), median(modified_final_balances)),
  Prob_Above_1000 = c(prob_original_above_1000, prob_modified_above_1000),
  Prob_Above_10000 = c(prob_original_above_10000, prob_modified_above_10000)
)

cat("\nStrategy Comparison Results:\n")
cat("============================\n")
cat("Strategy 1 - Probability > $1,000: ", round(prob_original_above_1000, 3), " (", round(prob_original_above_1000 * 100, 1), "%)\n")
cat("Strategy 2 - Probability > $1,000: ", round(prob_modified_above_1000, 3), " (", round(prob_modified_above_1000 * 100, 1), "%)\n")
cat("Strategy 1 - Probability > $10,000: ", round(prob_original_above_10000, 3), " (", round(prob_original_above_10000 * 100, 1), "%)\n")
cat("Strategy 2 - Probability > $10,000: ", round(prob_modified_above_10000, 3), " (", round(prob_modified_above_10000 * 100, 1), "%)\n")

if (prob_modified_above_10000 > prob_original_above_10000) {
  cat("Result: Strategy 2 has HIGHER probability of > $10,000\n")
} else {
  cat("Result: Strategy 2 has LOWER probability of > $10,000\n")
}

print(comparison_summary)
```

## Key Findings

::: {.callout-warning}
## Risk-Return Analysis

1. **Expected Value Misleading**: Despite a positive 5% expected return, most simulations result in losses below the initial investment.

2. **Extreme Volatility**: Final balances range from near zero to potentially millions, demonstrating the high-risk nature of multiplicative investment strategies.

3. **Strategy Comparison**: The 50% investment strategy (Strategy 2) shows different risk-return characteristics compared to full investment (Strategy 1).
:::

### Probability Results

- **Strategy 1**: Probability of ending above $1,000 is approximately 0.XX (XX%)
- **Strategy 2**: Probability of ending above $10,000 is approximately 0.XX (XX%)

### Strategic Implications

This analysis demonstrates several critical concepts:

1. **Expected Value vs. Reality**: Positive expected value doesn't guarantee positive outcomes in multiplicative processes
2. **Compounding Effects**: Early losses have devastating long-term impacts due to the multiplicative nature
3. **Risk Management**: Position sizing and diversification are crucial for managing investment risk
4. **Simulation Power**: Monte Carlo methods reveal the true distribution of possible outcomes

::: {.callout-tip}
## Conclusion

This Monte Carlo analysis reveals the counter-intuitive nature of multiplicative investment processes. While theoretical expected value calculations suggest positive returns, the reality of compounding effects leads to extreme outcomes with high downside risk. Understanding these dynamics is essential for making informed investment decisions and implementing appropriate risk management strategies.

The comparison between full investment and partial investment strategies demonstrates how position sizing can significantly impact risk-return profiles, highlighting the importance of strategic portfolio management in real-world investment scenarios.

**Key Takeaway**: Expected value alone is insufficient for investment decisions - understanding the full distribution of outcomes is crucial for risk management.
:::